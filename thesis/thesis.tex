% -*- TeX-PDF-mode: t -*-

% XXX 12pt?  Measure is a bit long in 11pt.
% XXX Use monospace for \code?

% draft - Fast compilation, all XXX notes, draft+git footers
\documentclass[11pt,twoside,draft]{mitthesis}
% (no option) - Full compilation, all XXX notes, draft+git footer
%\documentclass[11pt,twoside]{mitthesis}
% final - Full compilation, no XXX notes, no footer
%\documentclass[11pt,twoside,final]{mitthesis}

\usepackage[square,comma,numbers,sort&compress]{natbib}

% Put hyperref in final mode; otherwise hyperlinks are disabled
\usepackage[pdfauthor={Austin T. Clements, M. Frans Kaashoek, Nickolai Zeldovich, Robert T. Morris, and Eddie Kohler},
            pdftitle={The Scalable Commutativity Rule: Designing Scalable Software for Multicore Processors},
            breaklinks,hidelinks,final]{hyperref}

\usepackage{times,mathptmx}
\usepackage{textcomp}
\usepackage{verbatim}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{xspace}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{url}
\usepackage{listings}
\usepackage{balance}
\usepackage{gnuplot-lua-tikz}
\usepackage{subfig}
\usepackage{booktabs}
\usepackage[T1]{fontenc}
\usepackage{multirow}
\usepackage{rotating}
\usepackage{fancyvrb}
\usepackage[defaultsans]{lato}
\usepackage{lastpage}
\usepackage{alltt}
\usepackage{mathrsfs}
\usepackage{etoolbox}
\usepackage{ifdraft}
\usepackage{cleveref} % After hyperref, listings
\IfFileExists{microtype.sty}{
  \usepackage{microtype}
}{
  \PackageError{microtype}{Package microtype not found.  Please
    install texlive-latex-recommended}{}
}

% Local packages below here

\usepackage{xxxnotes}
\usepackage{gitinfo}

\usepackage{scp-macros}
\usetikzlibrary{calc}
\usetikzlibrary{shapes.geometric}
\usetikzlibrary{shapes.misc}

\input{glyphtounicode}
\pdfgentounicode=1

\DeclareMathAlphabet{\mathcal}{OMS}{cmsy}{m}{n}

% Draft footer
\ifoptiondraft{\fancyfoot[L]{\textbf{FAST DRAFT}}}%
{\ifoptionfinal{}{\fancyfoot[L]{\textbf{DRAFT}}}}%

% One space after periods
\frenchspacing

% Avoid widows and orphans
\widowpenalty=500
\clubpenalty=500

% Double spacing is too big; single spacing is too small
\linespread{1.15}

% Aggressive figure placement
\renewcommand{\topfraction}{0.9}
\renewcommand{\bottomfraction}{0.8}
\setcounter{topnumber}{2}
\setcounter{bottomnumber}{2}
\setcounter{totalnumber}{4}
\setcounter{dbltopnumber}{2}
\renewcommand{\dbltopfraction}{0.9}
\renewcommand{\textfraction}{0.07}
\renewcommand{\floatpagefraction}{0.7}
\renewcommand{\dblfloatpagefraction}{0.7}

\setlength{\marginparwidth}{0.8in}

% For text from the SOSP paper, define CompactItemize
\newenvironment{CompactItemize}{\begin{itemize}}{\end{itemize}}

% Fix things like \emph{foo\xspace}.  See
% http://tug.org/pipermail/texhax/2006-November/007339.html
\makeatletter
\xspaceaddexceptions{\check@icr}
\makeatother

% Listing style
\lstset{basicstyle=\fontsize{9}{9}\sffamily,showstringspaces=false,columns=fullflexible}

% Use \code{...} for inline code.  Note that \code will typeset
% hyphens as minus signs.  You can use $math$ in \code.
\makeatletter
\def\@mathcode#1{\text{\code{#1}}}
\def\@regcode{\lstinline[mathescape=true]}
\def\@code{\ifmmode\let\next\@mathcode\else\let\next\@regcode\fi\next}
\def\code{\protect\@code}
\makeatother
\let\syscall=\code
% Code in gnuplot labels
\def\gpcode#1{{\fontsize{6}{6}\sffamily #1}}

\RecustomVerbatimEnvironment{Verbatim}{Verbatim}{formatcom=\footnotesize}

\renewcommand{\ttdefault}{pxtt}

\newcommand{\vm}{RadixVM\xspace}
\newcommand{\refcache}{Refcache\xspace}
\newcommand{\sys}{sv6\xspace}
\newcommand{\tool}{{\scshape Commuter}\xspace}
\newcommand{\analyzer}{{\scshape Analyzer}\xspace}
\newcommand{\testgen}{{\scshape Testgen}\xspace}
\newcommand{\mtrace}{{\scshape Mtrace}\xspace}
\newcommand{\SIM}{SIM\xspace}
\newcommand{\fs}{ScaleFS\xspace}

\newcommand{\inputcode}[1]{%
  {\small\hrule\vspace{0.5em}\input{#1}\hrule\vspace{0.5em}}}

\newcommand{\inputnodraft}[1]{%
  \ifdraft{#1 omitted in draft mode}{\input{#1}}}

\newcommand{\splitcaption}[2]{\caption[#1]{#1 #2}}

\bibpunct[: ]{[}{]}{,}{n}{XXX}{XXX}

% Do always capitalize "Figure".  Also override the default "Fig."
\crefname{figure}{Figure}{Figures}
\crefname{mysubfigure}{Figure}{Figures}
\Crefname{mysubfigure}{Figure}{Figures}

\makeatother


\begin{document}

\input{pyexpr}
\input{code/fmt}

\input{title}
\cleardoublepage

\begin{abstractpage}
\input{abstract}
\end{abstractpage}
\cleardoublepage

\begin{singlespace}
\input{acks}
\end{singlespace}

\pagestyle{plain}
\tableofcontents
\newpage
\listoffigures \XXX!{Check if this is reasonable}
\XXX{Check for overlong captions and use splitcaption}
\newpage
\listoftables \XXX!{Check if this is reasonable}

% Shift sectioning commands to start at \chapter
\let\subsubsubsection\subsubsection
\let\subsubsection\subsection
\let\subsection\section
\let\section\chapter

\input{intro}
\input{related}
\input{scalability}
\input{rule}
\input{posix}
% \input{example}
\input{tool}
\input{linux}
\input{sv6}
\input{eval}
\input{concl}


{
\begin{singlespace}
\bibliographystyle{plainnat}
\bibliography{n-str,local,n,n-conf,kpubs}
\end{singlespace}
}

\end{document}
